import{j as t}from"../assets/jsx-runtime.CnDyYxjH.js";import{r as e}from"../assets/index.BiaIGwig.js";class s{lastScrollState=null;lastScrollProgress=-1;lastAriaLabel="";ticking=!1;scrollButton=null;scrollIcon=null;scrollStep=0;isScrolling=!1;documentHeight=0;boundThrottledScroll;boundHandleResize;boundHandleClick;constructor(){this.boundThrottledScroll=this.throttledScroll.bind(this),this.boundHandleResize=this.handleResize.bind(this),this.boundHandleClick=this.handleClick.bind(this),this.init()}init(){this.scrollButton=document.getElementById("scroll-button"),this.scrollButton?(this.scrollIcon=this.scrollButton.querySelector(".scroll-icon"),this.scrollStep=.8*window.innerHeight,this.updateDocumentHeight(),this.updateScrollState(),this.updateScrollButton(),window.addEventListener("scroll",this.boundThrottledScroll,{passive:!0}),window.addEventListener("resize",this.boundHandleResize,{passive:!0}),this.scrollButton.addEventListener("click",this.boundHandleClick)):setTimeout((()=>this.init()),100)}updateDocumentHeight(){this.documentHeight=document.documentElement.scrollHeight-window.innerHeight}handleResize(){this.updateDocumentHeight(),this.updateScrollButton()}throttledScroll(){this.ticking||(requestAnimationFrame((()=>{this.updateScrollState(),this.updateScrollButton(),this.ticking=!1})),this.ticking=!0)}updateScrollState(){const t=window.scrollY>10?"1":"0";this.lastScrollState!==t&&(document.documentElement.setAttribute("data-scroll",t),this.lastScrollState=t)}updateScrollButton(){if(!this.scrollButton||!this.scrollIcon)return;const t=window.pageYOffset||document.documentElement.scrollTop,e=Math.min(t/this.documentHeight,1);if(Math.abs(e-this.lastScrollProgress)>.01){const t=360*e;this.scrollButton.style.setProperty("--progress",`${t}deg`),this.lastScrollProgress=e}const s=e>.9,o=s?"返回顶部":"向下滚动";this.lastAriaLabel!==o&&(this.scrollIcon.style.transform=s?"rotate(180deg)":"rotate(0deg)",this.scrollButton.setAttribute("aria-label",o),this.lastAriaLabel=o)}handleClick(t){if(t.preventDefault(),this.isScrolling||!this.scrollButton)return;this.isScrolling=!0;const e=window.pageYOffset||document.documentElement.scrollTop,s=e/this.documentHeight>.9?0:Math.min(e+this.scrollStep,this.documentHeight);window.scrollTo({top:s,behavior:"smooth"});const o=()=>{this.isScrolling=!1,window.removeEventListener("scroll",o)};window.addEventListener("scroll",o,{passive:!0}),setTimeout((()=>{this.isScrolling=!1}),500)}destroy(){window.removeEventListener("scroll",this.boundThrottledScroll),window.removeEventListener("resize",this.boundHandleResize),this.scrollButton&&this.scrollButton.removeEventListener("click",this.boundHandleClick)}}function o(){const o=e.useRef(null),n=e.useRef(!1),[r,l]=e.useState(!1),[i,c]=e.useState(!1),[d,u]=e.useState(!1),a=e.useCallback((()=>{n.current||(n.current=!0,o.current&&(o.current.destroy(),o.current=null),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{o.current=new s,n.current=!1})):(o.current=new s,n.current=!1))}),[]),h=e.useEffectEvent((()=>{o.current||a()})),m=e.useEffectEvent((()=>{setTimeout((()=>{o.current&&(o.current.destroy(),o.current=null),a()}),100)})),v=e.useEffectEvent((()=>{o.current&&(o.current.destroy(),o.current=null)}));return e.useLayoutEffect((()=>{requestAnimationFrame((()=>{c(!0),u(!0)}))}),[]),e.useEffect((()=>{if(!i)return;a();const t=()=>h(),e=()=>m(),s=()=>v();return window.addEventListener("load",t),document.addEventListener("astro:page-load",e),document.addEventListener("astro:before-preparation",s),()=>{o.current&&(o.current.destroy(),o.current=null),window.removeEventListener("load",t),document.removeEventListener("astro:page-load",e),document.removeEventListener("astro:before-preparation",s)}}),[a,i]),e.useEffect((()=>{if(!i||!d)return;const t=()=>{const t=window.scrollY;l(t>100)};return t(),window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)}),[i,d]),t.jsx(e.Activity,{mode:d&&r?"visible":"hidden",children:t.jsx("button",{id:"scroll-button",className:"scroll-button","aria-label":"向下滚动",style:i?void 0:{"--progress":"0deg"},children:t.jsx("svg",{className:"scroll-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:i?void 0:{transform:"rotate(0deg)"},children:t.jsx("path",{d:"M12 1v22m-6-6l6 6 6-6"})})})})}export{o as default};
